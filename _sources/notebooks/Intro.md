# Introduction to Cloud Regimes
Cloud Regimes (also called Weather States in previous work) apply k-means clustering to cloud optical depth - cloud top height joint histograms produced by satellite cloud data products such as ISCCP, MODIS, and MISR, as well as models running with satellite simulators. An example histogram is shown below. 
![example_histogram] (./images/example_histo.png)

This is a random ISCCP histogram in which cloud top pressure decreases on the y axis, and cloud optical depth increases on the x axis. The color of each bin is indicative of the amount of cloud recorded in each bin according to the color bar on the right. These observations exist across the globe with time spans beginning as early as 1983. In short, these histograms are then fed into the kmeans clustering algorithm  to spit out a set of clusters / Cloud Regimes (CRs). However, the entire process isn't quite that simple. K-means requires the user to specify k, which is the number of CRs that k-means will create. We must choose a value that represents the number of distinct CRs that exist within our data. This process is examined in the first chapter, Choosing a Value of k. Second, since k-means utilizes an element of randomness to initiate it's clusters it will not necessarily give the same result every time. We must be sure that we choose k-means parameters that result in very similar CRs every time it is preformed. This is covered in the second chapter: Testing Cluster Robustness / Repeatability of Results. Finally once the best value of K has been chosen, and we know our clusters are robust, we will begin simple analysis on our CRs in the final chapter: Mapping and Analyzing Cloud Regimes.

In previous work other than (Davis and Medeiros 2023), CRs have been made with the conventional k-means algorithm utilizing euclidean distance as a distance metric. However, euclidean distance has some shortcomings when being applied to these cloud height - cloud optical depth histograms, as it cannot account for the two dimensional nature of these histograms. Consider the three hypothetival histograms shown below.

![hypothetical_histograms] (./images/./wasserstein_example_diagram.png


Each of these histograms contain 50% cloud cover in a single bin: in the first, the cloud is in the thickest, highest cloud top bin, the second is shifted one pressure bin away, and the third has the cloud in the thinnest, lowest cloud top bin. The euclidean distances between the three histograms are the same, but we would hope that a one-bin shift would be “nearer” than a multi-bin shift. This is where Wasserstein distance (also called earth movers distance) comes in. Unlike euclidean distance, Wasserstein distance understands that the first two histograms are much closer together than the first and the third histogram. The disadvantage of Wasserstein distance however is the complexity. It is much slower than euclidean distance and much more compute intensive. However, the implementation of k-means with Wasserstein distance included in this cookbook scales very well across multiple CPU, the more CPU the faster it will run. However, in the binder environment this cookbook will be run in, it will be prohibitively slow. There is the option to run with either euclidean or wasserstein distance, so it may be best to run through this first with euclidean distance and save wasserstein distance for experimenting in a local environment with more computing power. Operationally, the two workflows will be the same. The purpose of this cookbook is to provide the scripts and instruction on the creation of CRs. A user who wishes to create and analyse CRs should run through this tutorial in the binder environment with the included toy data, and then they should download the scripts and run them in an environment with much more compute power and memory on the data they wish to process. 


